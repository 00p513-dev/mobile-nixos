#!/usr/bin/env nix-shell
#!nix-shell -p ruby -i ruby

require "shellwords"

# Given a device name, instantiates `nix-build` to build
# everything needed to boot on that device.

ROOT = File.join(__dir__, "..")

if ARGV.count < 1 then
	puts "Usage: bin/build <device-name>"
	exit 1
end

DEVICE = ARGV.shift

cmd = [
	"nix-build", "-A", "all",
	"--argstr", "device", DEVICE,
	*ARGV
]

puts " $ #{cmd.shelljoin}"

system(*cmd)

exit $?.exitstatus
# vim: ft=ruby
