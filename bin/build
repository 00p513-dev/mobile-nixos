#!/usr/bin/env nix-shell
#!nix-shell -p ruby -i ruby

require "shellwords"

def run(*cmd)
puts " $ #{cmd.shelljoin}"
	system(*cmd)
	exit $?.exitstatus unless $?.exitstatus == 0
end

# Given a device name, instantiates `nix-build` to build
# everything needed to boot on that device.

ROOT = File.join(__dir__, "..")

if ARGV.count < 1 then
	puts "Usage: bin/build <device-name>"
	exit 1
end

DEVICE = ARGV.shift

run(
	"nix-build", "-A", "all",
	"--argstr", "device", DEVICE,
	*ARGV
)

# vim: ft=ruby
